<html lang="pt-br">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Invent치rio</title>
<script src="https://unpkg.com/html5-qrcode"></script>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&display=swap" rel="stylesheet">
<style>
:root {
  --primary: #4f8cff;
  --bg: #f6f8fb;
  --card: #ffffff;
  --text: #1f2937;
  --muted: #6b7280;
}

* { box-sizing: border-box; }

body {
  margin: 0;
  font-family: 'Inter', sans-serif;
  background: var(--bg);
  color: var(--text);
}

header {
  background: var(--card);
  padding: 16px;
  text-align: center;
  font-size: 18px;
  font-weight: 600;
  box-shadow: 0 2px 8px rgba(0,0,0,.05);
}

#search {
  width: calc(100% - 24px);
  margin: 12px;
  padding: 12px 14px;
  border-radius: 12px;
  border: 1px solid #e5e7eb;
  font-size: 15px;
}

.list { padding: 12px; }

.item {
  background: var(--card);
  margin-bottom: 12px;
  padding: 14px;
  border-radius: 16px;
  display: flex;
  justify-content: space-between;
  align-items: center;
  box-shadow: 0 6px 14px rgba(0,0,0,.06);
}

.item strong { font-weight: 600; }
.item small { color: var(--muted); }

.btn {
  padding: 10px 14px;
  background: var(--primary);
  color: #fff;
  border: none;
  border-radius: 12px;
  font-size: 14px;
}

.btn.small { padding: 8px 10px; font-size: 13px; }

#form {
  display: none;
  padding: 14px;
}

input {
  width: 100%;
  padding: 12px;
  margin-bottom: 10px;
  border-radius: 12px;
  border: 1px solid #e5e7eb;
  font-size: 15px;
}

#scanner { padding: 12px; }

footer {
  position: fixed;
  bottom: 0;
  width: 100%;
  background: var(--card);
  display: flex;
  box-shadow: 0 -2px 10px rgba(0,0,0,.08);
}

footer button {
  flex: 1;
  border: none;
  padding: 14px;
  font-size: 15px;
  background: none;
  color: var(--primary);
  font-weight: 500;
}
</style>
</head>
<body>
Estoque / Invent치rio



  Invent치rio
  
  
  
<button class="btn" id="btnSalvar" onclick="salvar()">Salvar</button>



  <button onclick="listar()">In칤cio</button>
  <button onclick="abrirScanner()">游닝 C칩digo</button>
  <button onclick="novo()">Novo</button>

<script>
const API_URL = "https://script.google.com/macros/s/AKfycbxTi5AFX39uZnBetd1VLwPy-lYGqudUspXfA_zozonkhl9p2xDPsri1jfFtL9vGBi_e/exec";

let itens = [];
let itemAtual = null;
let salvando = false;

// LISTAR
function listar() {
document.getElementById("form").style.display = "none";
document.getElementById("scanner").style.display = "none";
document.getElementById("lista").style.display = "block";

fetch(API_URL + "?action=listarProdutos")
.then(r => r.json())
.then(d => {
itens = d;
render(d);
});
}

// RENDER
function render(data) {
const div = document.getElementById("lista");
div.innerHTML = "";

data.forEach(i => {
if (!i.codigo_barras) return;

div.innerHTML += `
<div class="item">
<div>
<strong>${i.descricao}</strong><br>
<small>Qtd: ${i.qtd_atual}</small>
</div>
<button class="btn small" onclick='editar(${JSON.stringify(i)})'>Editar</button>
</div>
`;
});
}

// BUSCA NA LISTA
document.getElementById("search").addEventListener("input", e => {
const t = e.target.value.toLowerCase();
render(itens.filter(i =>
JSON.stringify(i).toLowerCase().includes(t)
));
});

// EDITAR
function editar(i) {
itemAtual = i;
document.getElementById("lista").style.display = "none";
document.getElementById("form").style.display = "block";

codigo.value = i.codigo_barras || "";
descricao.value = i.descricao || "";
modelo.value = i.modelo || "";
cor.value = i.cor || "";
tamanho.value = i.tamanho || "";
qtd_atual.value = i.qtd_atual || "";
}

function novo() {
itemAtual = {};
document.getElementById("lista").style.display = "none";
document.getElementById("form").style.display = "block";

// Limpa todos os campos
codigo.value = "";
descricao.value = "";
modelo.value = "";
cor.value = "";
tamanho.value = "";
qtd_atual.value = "";
contagem1.value = "";
contagem2.value = "";
contagem3.value = "";
obs.value = "";
}

// SALVAR
function salvar() {
if (salvando) return;
salvando = true;

const btn = document.getElementById("btnSalvar");
btn.disabled = true;
btn.innerText = "Salvando...";

const data = {
action: "salvar",
codigo_barras: codigo.value.trim(),
descricao: descricao.value,
modelo: modelo.value,
cor: cor.value,
tamanho: tamanho.value,
qtd_atual: qtd_atual.value,
contagem_1: contagem1.value,
contagem_2: contagem2.value,
contagem_3: contagem3.value,
observacao: obs.value,
_row: itemAtual?._row
};

fetch(API_URL, {
method: "POST",
body: JSON.stringify(data),
headers: { "Content-Type": "text/plain" }
}).finally(() => {
salvando = false;
btn.disabled = false;
btn.innerText = "Salvar";
});

limparFormulario();
listar();
}

// LIMPAR FORMUL츼RIO E VOLTAR  LISTA
function limparFormulario() {
itemAtual = null;
codigo.value = "";
descricao.value = "";
modelo.value = "";
cor.value = "";
tamanho.value = "";
qtd_atual.value = "";
contagem1.value = "";
contagem2.value = "";
contagem3.value = "";
obs.value = "";
document.getElementById("form").style.display = "none";
document.getElementById("lista").style.display = "block";
}

// SCANNER
function abrirScanner() {
document.getElementById("lista").style.display = "none";
document.getElementById("scanner").innerHTML = ""; // Limpa scanner anterior
document.getElementById("scanner").style.display = "block";

const html5 = new Html5Qrcode("scanner");
html5.start(
{ facingMode: "environment" },
{ fps: 10, qrbox: { width: 250, height: 250 } },
code => {
html5.stop().then(() => {
document.getElementById("scanner").innerHTML = "";
document.getElementById("scanner").style.display = "none";
});
buscarCodigo(code);
},
error => { /* ignorar erros de leitura */ }
).catch(err => {
alert("Erro ao iniciar a c칙mera: " + err);
});
}

function buscarCodigo(codigoLido) {
fetch(API_URL + "?action=buscar&codigo=" + encodeURIComponent(codigoLido.trim()))
.then(r => r.json())
.then(d => {
if (d.notFound) {
novo();
codigo.value = codigoLido.trim();
alert("Produto n칚o encontrado. Preencha os dados para cadastrar um novo.");
} else {
editar(d);
}
})
.catch(err => {
console.error(err);
alert("Erro ao buscar produto. Verifique sua conex칚o.");
});
}

// BUSCA MANUAL AO DIGITAR O C칍DIGO
document.getElementById("codigo").addEventListener("blur", function() {
const codigoDigitado = this.value.trim();
if (codigoDigitado && (!itemAtual || (itemAtual.codigo_barras || "").toString().trim() !== codigoDigitado)) {
buscarCodigoManual(codigoDigitado);
}
});

// Permitir busca com Enter no campo c칩digo
document.getElementById("codigo").addEventListener("keydown", function(e) {
if (e.key === "Enter") {
e.preventDefault();
this.blur();
}
});

function buscarCodigoManual(codigo) {
fetch(API_URL + "?action=buscar&codigo=" + encodeURIComponent(codigo))
.then(r => r.json())
.then(d => {
if (d.notFound) {
descricao.value = "";
modelo.value = "";
cor.value = "";
tamanho.value = "";
qtd_atual.value = "";
alert("Produto n칚o encontrado. Preencha os dados para cadastrar um novo.");
} else {
editar(d);
}
})
.catch(err => {
console.error(err);
alert("Erro ao buscar produto. Verifique sua conex칚o.");
});
}

// Inicia a aplica칞칚o listando os produtos
listar();
</script>
</body>
</html>